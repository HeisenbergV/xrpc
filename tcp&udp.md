# tcp&udp

## TCP/IP 架构
应用层（http grpc）
传输层（tcp udp）
网络层 (IP)
链路层 (硬件相关)

## 运输层
与应用层的关系：应用层将数据发送给运输层，运输层将其进行分段处理，每段数据加入头协议，然后分组发出去
与网络层的关系：分组的数据发给网络层，网络层将数据真正的发给链路层，然后从物理链路发到指定服务的进程中去

举例：
北京一个资产阶级家庭： 小明家庭
天津一个资产阶级家庭： 小红家庭
小明写了封信，交给管家，管家将信给邮政局，邮政局收到后，寄到天津小红家，管家将信给小红

小明家庭的任意成员写信->小明家的管家->邮局->小红家的管家->小红

应用层：信的内容
进程：小明
主机：小明的家庭 和 小红的家庭
运输层：管家
网络层：邮局


## 简单介绍udp tcp
tcp将应用层数据，分段处理 称为 报文段（seg-ment)
upd将应用层数据，分段处理 称为 数据报

IP层 网际协议，为主机之间提供逻辑通信，尽力而为的交付服务（best-effort delivery service)
所以不保证数据不会丢失，报文段的顺序，并且附带了一个唯一表示的地址也就是ip地址来进行主机之间的确认

udp和tcp 的基本责任是对两个端系统间的进程进行交付服务。
主机间交付扩展到进程间交付被称之为 运输层的多路复用，与多路分解

udp和ip层一样 无法提供可靠传输

tcp通过流量控制，序号，确认，定时器，达到可靠传输
tcp通过滑动窗口达到拥塞控制，为整个互联网提供平等的带宽

## 多路复用，多路分解
![运输层](运输层.png)

一个主机有多个进程，每个进程为了通信会建立一个套接字（socket)，而一个主机只有一个运输层，所以多个socket将数据传输给运输层，运输层将这些数据进行封装上首部信息（为了以后的分解）从而生成报文段。然后将报文段传递给网络层，这个过程就是多路复用。

当主机收到其他主机的数据，运输层根据报文段的首部信息找到指定的socket。这个过程就是多路分解

举例：依旧是上面的例子，当管家收到信件后，需要依靠信件上的名字，给指定的成员（小明，爸爸，妈妈）。
这个管家的操作就是多路分解。当成员（小明，爸爸，妈妈）写了信给管家，管家进行整理然后发送给邮政局，这个管家的操作就是多路复用

通过上述描述，运输层的多路复用的要求是：
1. 每一个套接字要有唯一的标识，否则运输层无法分辨该将数据给谁
2. 每个报文段要有特殊的字段来标识，要交付给哪个套接字（也就是端口 port）

|-----------------|
| 源端口 | 目的端口 |
|-----------------|
|   其他首部字段    |
|-----------------|
|    应用数据      |
|-----------------|

### udp的多路复用 多路分解
upd

### tcp的多路复用 多路分解

## 分段报文

## 可靠传输

